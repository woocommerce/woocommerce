!function(e,t){for(var r in t)e[r]=t[r]}(this,function(e){function t(t){for(var s,a,c=t[0],o=t[1],l=t[2],d=0,p=[];d<c.length;d++)a=c[d],i[a]&&p.push(i[a][0]),i[a]=0;for(s in o)Object.prototype.hasOwnProperty.call(o,s)&&(e[s]=o[s]);for(u&&u(t);p.length;)p.shift()();return n.push.apply(n,l||[]),r()}function r(){for(var e,t=0;t<n.length;t++){for(var r=n[t],s=!0,c=1;c<r.length;c++){var o=r[c];0!==i[o]&&(s=!1)}s&&(n.splice(t--,1),e=a(a.s=r[0]))}return e}var s={},i={10:0},n=[];function a(t){if(s[t])return s[t].exports;var r=s[t]={i:t,l:!1,exports:{}};return e[t].call(r.exports,r,r.exports,a),r.l=!0,r.exports}a.m=e,a.c=s,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var s in e)a.d(r,s,function(t){return e[t]}.bind(null,s));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="";var c=window.webpackJsonp=window.webpackJsonp||[],o=c.push.bind(c);c.push=t,c=c.slice();for(var l=0;l<c.length;l++)t(c[l]);var u=o;return n.push([621,12]),r()}({0:function(e,t){!function(){e.exports=this.wp.element}()},600:function(e,t,r){var s=r(601);"string"==typeof s&&(s=[[e.i,s,""]]);var i={hmr:!0,transform:void 0,insertInto:void 0};r(357)(s,i);s.locals&&(e.exports=s.locals)},601:function(e,t,r){},621:function(e,t,r){"use strict";r.r(t);var s=r(354),i=r.n(s),n=r(356),a=r.n(n),c=r(21),o=r.n(c),l=r(39),u=r.n(l),d=r(40),p=r.n(d),h=r(41),m=r.n(h),b=r(42),f=r.n(b),y=r(43),v=r.n(y),g=r(0),_=(r(600),wp.i18n.__),w=wp.element.Component,k=wp.components.Dashicon,O=wp.apiFetch,j={},E=function(e){function t(e){var r;return u()(this,t),(r=m()(this,f()(t).call(this,e))).state={selectedProducts:e.selected_display_setting||[]},r}return v()(t,e),p()(t,[{key:"addOrRemoveProduct",value:function(e){var t=this.state.selectedProducts;t.includes(e)?t=t.filter(function(t){return t!==e}):t.push(e),this.setState({selectedProducts:t}),this.props.update_display_setting_callback(t.slice())}},{key:"render",value:function(){return Object(g.createElement)("div",{className:"wc-products-list-card wc-products-list-card--specific"},Object(g.createElement)(C,{addOrRemoveProductCallback:this.addOrRemoveProduct.bind(this),selectedProducts:this.state.selectedProducts}),Object(g.createElement)(T,{columns:this.props.attributes.columns,productIds:this.state.selectedProducts,addOrRemoveProduct:this.addOrRemoveProduct.bind(this)}))}}]),t}(w),C=function(e){function t(e){var r;return u()(this,t),(r=m()(this,f()(t).call(this,e))).state={searchText:"",dropdownOpen:!1},r.updateSearchResults=r.updateSearchResults.bind(o()(o()(r))),r.setWrapperRef=r.setWrapperRef.bind(o()(o()(r))),r.handleClickOutside=r.handleClickOutside.bind(o()(o()(r))),r.isDropdownOpen=r.isDropdownOpen.bind(o()(o()(r))),r}return v()(t,e),p()(t,[{key:"componentDidMount",value:function(){document.addEventListener("mousedown",this.handleClickOutside)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousedown",this.handleClickOutside)}},{key:"setWrapperRef",value:function(e){this.wrapperRef=e}},{key:"handleClickOutside",value:function(e){this.wrapperRef&&!this.wrapperRef.contains(e.target)&&this.setState({searchText:""})}},{key:"isDropdownOpen",value:function(e){this.setState({dropdownOpen:!!e})}},{key:"updateSearchResults",value:function(e){this.setState({searchText:e.target.value})}},{key:"render",value:function(){var e="wc-products-list-card__search-wrapper";return Object(g.createElement)("div",{className:e+(this.state.dropdownOpen?" "+e+"--with-results":""),ref:this.setWrapperRef},Object(g.createElement)("div",{className:"wc-products-list-card__input-wrapper"},Object(g.createElement)(k,{icon:"search"}),Object(g.createElement)("input",{type:"search",className:"wc-products-list-card__search",value:this.state.searchText,placeholder:_("Search for products to display"),onChange:this.updateSearchResults})),Object(g.createElement)(S,{searchString:this.state.searchText,addOrRemoveProductCallback:this.props.addOrRemoveProductCallback,selectedProducts:this.props.selectedProducts,isDropdownOpenCallback:this.isDropdownOpen}))}}]),t}(w),S=function(e){function t(e){var r;return u()(this,t),(r=m()(this,f()(t).call(this,e))).state={products:[],query:"",loaded:!1},r.updateResults=r.updateResults.bind(o()(o()(r))),r.getQuery=r.getQuery.bind(o()(o()(r))),r}return v()(t,e),p()(t,[{key:"componentDidMount",value:function(){this.updateResults()}},{key:"componentDidUpdate",value:function(){this.getQuery()!==this.state.query&&this.updateResults()}},{key:"getQuery",value:function(){return this.props.searchString.length?"/wc-blocks/v1/products?per_page=10&status=publish&search="+this.props.searchString:""}},{key:"updateResults",value:function(){var e=this,t=this.getQuery();e.setState({query:t,loaded:!1}),t.length?O({path:t}).then(function(r){t===e.getQuery()&&e.setState({products:r,loaded:!0})}):e.setState({products:[],loaded:!0})}},{key:"render",value:function(){if(!this.state.loaded||!this.state.query.length)return null;if(0===this.state.products.length)return Object(g.createElement)("span",{className:"wc-products-list-card__search-no-results"}," ",_("No products found")," ");var e=!0,t=!1,r=void 0;try{for(var s,i=this.state.products[Symbol.iterator]();!(e=(s=i.next()).done);e=!0){var n=s.value;j[n.id]=n}}catch(e){t=!0,r=e}finally{try{e||null==i.return||i.return()}finally{if(t)throw r}}return Object(g.createElement)(P,{products:this.state.products,addOrRemoveProductCallback:this.props.addOrRemoveProductCallback,selectedProducts:this.props.selectedProducts,isDropdownOpenCallback:this.props.isDropdownOpenCallback})}}]),t}(w),P=function(e){function t(){return u()(this,t),m()(this,f()(t).apply(this,arguments))}return v()(t,e),p()(t,[{key:"componentDidMount",value:function(){this.props.isDropdownOpenCallback(!0)}},{key:"componentWillUnmount",value:function(){this.props.isDropdownOpenCallback(!1)}},{key:"render",value:function(){var e=this.props,t=e.products,r=e.addOrRemoveProductCallback,s=e.selectedProducts,i=[],n=!0,a=!1,c=void 0;try{for(var o,l=t[Symbol.iterator]();!(n=(o=l.next()).done);n=!0){var u=o.value;i.push(Object(g.createElement)(x,{product:u,addOrRemoveProductCallback:r,selected:s.includes(u.id),key:u.id}))}}catch(e){a=!0,c=e}finally{try{n||null==l.return||l.return()}finally{if(a)throw c}}return Object(g.createElement)("div",{role:"menu",className:"wc-products-list-card__search-results","aria-orientation":"vertical","aria-label":_("Products list")},Object(g.createElement)("div",null,i))}}]),t}(w),x=function(e){function t(e){var r;return u()(this,t),(r=m()(this,f()(t).call(this,e))).handleClick=r.handleClick.bind(o()(o()(r))),r}return v()(t,e),p()(t,[{key:"handleClick",value:function(){this.props.addOrRemoveProductCallback(this.props.product.id)}},{key:"render",value:function(){var e=this.props.product,t=this.props.selected?Object(g.createElement)(k,{icon:"yes"}):null,r=0!==e.images.length?Object(g.createElement)("img",{src:e.images[0].src,alt:e.name}):null;return Object(g.createElement)("div",{className:"wc-products-list-card__content"+(this.props.selected?" wc-products-list-card__content--added":""),onClick:this.handleClick},r,Object(g.createElement)("span",{className:"wc-products-list-card__content-item-name"},e.name),t)}}]),t}(w),T=function(e){function t(e){var r;return u()(this,t),(r=m()(this,f()(t).call(this,e))).state={query:"",loaded:!1},r.updateProductCache=r.updateProductCache.bind(o()(o()(r))),r.getQuery=r.getQuery.bind(o()(o()(r))),r}return v()(t,e),p()(t,[{key:"componentDidMount",value:function(){this.updateProductCache()}},{key:"componentDidUpdate",value:function(){this.state.loaded&&this.getQuery()!==this.state.query&&this.updateProductCache()}},{key:"getQuery",value:function(){if(!this.props.productIds.length)return"";var e=[],t=!0,r=!1,s=void 0;try{for(var i,n=this.props.productIds[Symbol.iterator]();!(t=(i=n.next()).done);t=!0){var a=i.value;j.hasOwnProperty(a)||e.push(a)}}catch(e){r=!0,s=e}finally{try{t||null==n.return||n.return()}finally{if(r)throw s}}return e.length?"/wc-blocks/v1/products?include="+e.join(","):""}},{key:"updateProductCache",value:function(){var e=this,t=this.getQuery();e.setState({query:t,loaded:!1}),t.length&&O({path:t}).then(function(t){if(t.length){var r=!0,s=!1,i=void 0;try{for(var n,a=t[Symbol.iterator]();!(r=(n=a.next()).done);r=!0){var c=n.value;j[c.id]=c}}catch(e){s=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(s)throw i}}}e.setState({loaded:!0})})}},{key:"render",value:function(){var e=this,t=[],r=!0,s=!1,i=void 0;try{for(var n,a=function(){var r=n.value;if(!j.hasOwnProperty(r))return"continue";var s=j[r],i=0!==s.images.length?Object(g.createElement)("img",{src:s.images[0].src,alt:s.name}):null;t.push(Object(g.createElement)("li",{className:"wc-products-list-card__item",key:s.id+"-specific-select-edit"},Object(g.createElement)("div",{className:"wc-products-list-card__content"},i,Object(g.createElement)("span",{className:"wc-products-list-card__content-item-name"},s.name),Object(g.createElement)("button",{type:"button",id:"product-"+s.id,onClick:function(){e.props.addOrRemoveProduct(s.id)}},Object(g.createElement)(k,{icon:"no-alt"})))))},c=this.props.productIds[Symbol.iterator]();!(r=(n=c.next()).done);r=!0)a()}catch(e){s=!0,i=e}finally{try{r||null==c.return||c.return()}finally{if(s)throw i}}return Object(g.createElement)("div",{className:"wc-products-list-card__results-wrapper wc-products-list-card__results-wrapper--cols-"+this.props.columns},Object(g.createElement)("div",{role:"menu",className:"wc-products-list-card__results","aria-orientation":"vertical","aria-label":_("Selected products")},t.length>0&&Object(g.createElement)("h3",null,_("Selected products")),Object(g.createElement)("ul",null,t)))}}]),t}(w),N=r(595),Q=r.n(N),D=wp.i18n.__,R=wp.element.Component,A=wp.components.Dashicon,I=wp.apiFetch,L=function(e){function t(e){var r;return u()(this,t),(r=m()(this,f()(t).call(this,e))).state={selectedCategories:e.selected_display_setting,openAccordion:[],filterQuery:"",firstLoad:!0},r.checkboxChange=r.checkboxChange.bind(o()(o()(r))),r.accordionToggle=r.accordionToggle.bind(o()(o()(r))),r.filterResults=r.filterResults.bind(o()(o()(r))),r.setFirstLoad=r.setFirstLoad.bind(o()(o()(r))),r}return v()(t,e),p()(t,[{key:"checkboxChange",value:function(e,t){var r,s=this.state.selectedCategories;(s=s.filter(function(e){return!t.includes(e)}),e)&&(r=s).push.apply(r,Q()(t));this.setState({selectedCategories:s}),this.props.update_display_setting_callback(s)}},{key:"accordionToggle",value:function(e){var t=this.state.openAccordion;t.includes(e)?t=t.filter(function(t){return t!==e}):t.push(e),this.setState({openAccordion:t})}},{key:"filterResults",value:function(e){this.setState({filterQuery:e.target.value})}},{key:"setFirstLoad",value:function(e){this.setState({firstLoad:!!e})}},{key:"render",value:function(){return Object(g.createElement)("div",{className:"wc-products-list-card wc-products-list-card--taxonomy wc-products-list-card--taxonomy-category"},Object(g.createElement)(q,{filterResults:this.filterResults}),Object(g.createElement)(M,{filterQuery:this.state.filterQuery,selectedCategories:this.state.selectedCategories,checkboxChange:this.checkboxChange,accordionToggle:this.accordionToggle,openAccordion:this.state.openAccordion,firstLoad:this.state.firstLoad,setFirstLoad:this.setFirstLoad}))}}]),t}(R),q=function(e){var t=e.filterResults;return Object(g.createElement)("div",{className:"wc-products-list-card__input-wrapper"},Object(g.createElement)(A,{icon:"search"}),Object(g.createElement)("input",{className:"wc-products-list-card__search",type:"search",placeholder:D("Search for categories"),onChange:t}))},M=function(e){function t(e){var r;return u()(this,t),(r=m()(this,f()(t).call(this,e))).state={categories:[],loaded:!1,query:""},r.updatePreview=r.updatePreview.bind(o()(o()(r))),r.getQuery=r.getQuery.bind(o()(o()(r))),r}return v()(t,e),p()(t,[{key:"componentDidMount",value:function(){this.getQuery()!==this.state.query&&this.updatePreview()}},{key:"componentDidUpdate",value:function(){this.getQuery()!==this.state.query&&this.state.loaded&&this.updatePreview()}},{key:"getQuery",value:function(){return"/wc-blocks/v1/products/categories"}},{key:"updatePreview",value:function(){var e=this,t=this.getQuery();e.setState({loaded:!1}),I({path:t}).then(function(r){e.setState({categories:r,loaded:!0,query:t})})}},{key:"render",value:function(){var e=this.props,t=e.filterQuery,r=e.selectedCategories,s=e.checkboxChange,i=e.accordionToggle,n=e.openAccordion,a=e.firstLoad,c=e.setFirstLoad;if(!this.state.loaded)return D("Loading");if(0===this.state.categories.length)return D("No categories found");var o=function e(t,r){var s=[];return r.filter(function(e){return e.parent===t.id}).forEach(function(t){s.push(t),s.push.apply(s,Q()(e(t,r)))}),s},l=function(e){var t=e.category,r=e.categories,s="arrow-down-alt2";n.includes(t.id)&&(s="arrow-up-alt2");var a=null;return function(e,t){return!!o(e,t).length}(t,r)||(a={visibility:"hidden"}),Object(g.createElement)("button",{onClick:function(){return i(t.id)},className:"wc-products-list-card__accordion-button",style:a,type:"button"},Object(g.createElement)(A,{icon:s}))},u=this.state.categories;return""!==t&&(u=u.filter(function(e){return e.slug.includes(t.toLowerCase())})),Object(g.createElement)("div",{className:"wc-products-list-card__results"},Object(g.createElement)(function e(t){var d=t.categories,p=t.parent,h=d.filter(function(e){return e.parent===p});return a&&r.length>0&&(u.filter(function(e){return 0===e.parent}).forEach(function(e){var t=o(e,u),s=!0,a=!1,c=void 0;try{for(var l,d=t[Symbol.iterator]();!(s=(l=d.next()).done);s=!0){var p=l.value;if(r.includes(p.id)&&!n.includes(e.id)){i(e.id);break}}}catch(e){a=!0,c=e}finally{try{s||null==d.return||d.return()}finally{if(a)throw c}}}),c(!1)),h.length>0&&Object(g.createElement)("ul",null,h.map(function(t){return Object(g.createElement)("li",{key:t.id,className:n.includes(t.id)?"wc-products-list-card__item wc-products-list-card__accordion-open":"wc-products-list-card__item"},Object(g.createElement)("label",{className:0===t.parent?"wc-products-list-card__content":"",htmlFor:"product-category-"+t.id},Object(g.createElement)("input",{type:"checkbox",id:"product-category-"+t.id,value:t.id,checked:r.includes(t.id),onChange:function(e){return function(e,t,r){var i=o(t,r).map(function(e){return e.id});i.push(t.id),s(e.target.checked,i)}(e,t,d)},ref:function(e){return e&&(e.indeterminate=function(e,t){if(r.includes(e.id))return!1;var s=o(e,t).map(function(e){return e.id}),i=!0,n=!1,a=void 0;try{for(var c,l=s[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var u=c.value;if(r.includes(u))return!0}}catch(e){n=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(n)throw a}}return!1}(t,d))}})," ",t.name,0===t.parent&&Object(g.createElement)(l,{category:t,categories:d}),Object(g.createElement)("span",{className:"wc-products-list-card__taxonomy-count"},t.count)),Object(g.createElement)(e,{categories:d,parent:t.id}))}))},{categories:u,parent:0}))}}]),t}(R),F=wp.i18n.__,W=wp.element.Component,U=wp.components.Dashicon,B=wp.apiFetch;function H(e,t){return e+","+t}function J(e){return e.split(",")[0]}var z=function(e){function t(e){var r;return u()(this,t),(r=m()(this,f()(t).call(this,e))).state={selectedAttribute:e.selected_display_setting.length?e.selected_display_setting[0]:"",selectedTerms:e.selected_display_setting.length>1?e.selected_display_setting.slice(1):[],filterQuery:""},r.setSelectedAttribute=r.setSelectedAttribute.bind(o()(o()(r))),r.addTerm=r.addTerm.bind(o()(o()(r))),r.removeTerm=r.removeTerm.bind(o()(o()(r))),r}return v()(t,e),p()(t,[{key:"setSelectedAttribute",value:function(e){this.setState({selectedAttribute:e,selectedTerms:[]}),this.props.update_display_setting_callback([e])}},{key:"addTerm",value:function(e){var t=this.state.selectedTerms;t.push(e),this.setState({selectedTerms:t});var r=[this.state.selectedAttribute];r=r.concat(t),this.props.update_display_setting_callback(r)}},{key:"removeTerm",value:function(e){var t=[],r=!0,s=!1,i=void 0;try{for(var n,a=this.state.selectedTerms[Symbol.iterator]();!(r=(n=a.next()).done);r=!0){var c=n.value;c!==e&&t.push(c)}}catch(e){s=!0,i=e}finally{try{r||null==a.return||a.return()}finally{if(s)throw i}}this.setState({selectedTerms:t});var o=[this.state.selectedAttribute];o=o.concat(t),this.props.update_display_setting_callback(o)}},{key:"updateFilter",value:function(e){this.setState({filterQuery:e.target.value})}},{key:"render",value:function(){return Object(g.createElement)("div",{className:"wc-products-list-card wc-products-list-card--taxonomy wc-products-list-card--taxonomy-atributes"},Object(g.createElement)(G,{updateFilter:this.updateFilter.bind(this)}),Object(g.createElement)(K,{selectedAttribute:this.state.selectedAttribute,selectedTerms:this.state.selectedTerms,filterQuery:this.state.filterQuery,setSelectedAttribute:this.setSelectedAttribute.bind(this),addTerm:this.addTerm.bind(this),removeTerm:this.removeTerm.bind(this)}))}}]),t}(W),G=function(e){return Object(g.createElement)("div",{className:"wc-products-list-card__input-wrapper"},Object(g.createElement)(U,{icon:"search"}),Object(g.createElement)("input",{className:"wc-products-list-card__search",type:"search",placeholder:F("Search for attributes"),onChange:e.updateFilter}))},K=function(e){function t(e){var r;return u()(this,t),(r=m()(this,f()(t).call(this,e))).state={attributes:[],loaded:!1,query:""},r.updatePreview=r.updatePreview.bind(o()(o()(r))),r.getQuery=r.getQuery.bind(o()(o()(r))),r}return v()(t,e),p()(t,[{key:"componentDidMount",value:function(){this.getQuery()!==this.state.query&&this.updatePreview()}},{key:"componentDidUpdate",value:function(){this.getQuery()!==this.state.query&&this.state.loaded&&this.updatePreview()}},{key:"getQuery",value:function(){return"/wc-blocks/v1/products/attributes"}},{key:"updatePreview",value:function(){var e=this,t=this.getQuery();e.setState({loaded:!1}),B({path:t}).then(function(r){e.setState({attributes:r,loaded:!0,query:t})})}},{key:"render",value:function(){var e=this.props,t=e.selectedAttribute,r=e.filterQuery,s=e.selectedTerms,i=e.setSelectedAttribute,n=e.addTerm,a=e.removeTerm;if(!this.state.loaded)return Object(g.createElement)("ul",null,Object(g.createElement)("li",null,F("Loading")));if(0===this.state.attributes.length)return Object(g.createElement)("ul",null,Object(g.createElement)("li",null,F("No attributes found")));var c=r.toLowerCase(),o=[],l=!0,u=!1,d=void 0;try{for(var p,h=this.state.attributes[Symbol.iterator]();!(l=(p=h.next()).done);l=!0){var m=p.value;c.length&&-1===m.name.toLowerCase().indexOf(c)||o.push(Object(g.createElement)(V,{attribute:m,selectedAttribute:t,selectedTerms:s,setSelectedAttribute:i,addTerm:n,removeTerm:a}))}}catch(e){u=!0,d=e}finally{try{l||null==h.return||h.return()}finally{if(u)throw d}}return Object(g.createElement)("div",{className:"wc-products-list-card__results"},o)}}]),t}(W),V=function(e){function t(e){var r;return u()(this,t),(r=m()(this,f()(t).call(this,e))).handleAttributeChange=r.handleAttributeChange.bind(o()(o()(r))),r.handleTermChange=r.handleTermChange.bind(o()(o()(r))),r}return v()(t,e),p()(t,[{key:"handleAttributeChange",value:function(e){e.target.checked&&this.props.setSelectedAttribute(e.target.value)}},{key:"handleTermChange",value:function(e){e.target.checked?this.props.addTerm(e.target.value):this.props.removeTerm(e.target.value)}},{key:"render",value:function(){var e=this.props.selectedAttribute===H(this.props.attribute.slug,this.props.attribute.id),t=null;e&&(t=Object(g.createElement)(X,{attribute:this.props.attribute,selectedTerms:this.props.selectedTerms,addTerm:this.props.addTerm,removeTerm:this.props.removeTerm}));var r=["wc-products-list-card--taxonomy-atributes__atribute"];e&&r.push("wc-products-list-card__accordion-open");var s=H(this.props.attribute.slug,this.props.attribute.id);return Object(g.createElement)("div",{className:r.join(" ")},Object(g.createElement)("div",null,Object(g.createElement)("label",{className:"wc-products-list-card__content",htmlFor:"attribute-".concat(s)},Object(g.createElement)("input",{type:"radio",id:"attribute-".concat(s),value:s,onChange:this.handleAttributeChange,checked:e}),this.props.attribute.name)),t)}}]),t}(W),X=function(e){function t(e){var r;return u()(this,t),(r=m()(this,f()(t).call(this,e))).state={terms:[],loaded:!1,query:""},r.updatePreview=r.updatePreview.bind(o()(o()(r))),r.getQuery=r.getQuery.bind(o()(o()(r))),r}return v()(t,e),p()(t,[{key:"componentDidMount",value:function(){this.getQuery()!==this.state.query&&this.updatePreview()}},{key:"componentDidUpdate",value:function(){this.getQuery()!==this.state.query&&this.state.loaded&&this.updatePreview()}},{key:"getQuery",value:function(){return"/wc-blocks/v1/products/attributes/"+this.props.attribute.id+"/terms"}},{key:"updatePreview",value:function(){var e=this,t=this.getQuery();e.setState({loaded:!1}),B({path:t}).then(function(r){e.setState({terms:r,loaded:!0,query:t})})}},{key:"render",value:function(){var e=this.props,t=e.selectedTerms,r=e.addTerm,s=e.removeTerm;if(!this.state.loaded)return Object(g.createElement)("ul",null,Object(g.createElement)("li",null,F("Loading")));if(0===this.state.terms.length)return Object(g.createElement)("ul",null,Object(g.createElement)("li",null,F("No terms found")));function i(e){e.target.checked?r(e.target.value):s(e.target.value)}return Object(g.createElement)("ul",null,this.state.terms.map(function(e,r){return Object(g.createElement)("li",{className:"wc-products-list-card__item",key:r},Object(g.createElement)("label",{className:"wc-products-list-card__content",htmlFor:"term-".concat(e.id)},Object(g.createElement)("input",{type:"checkbox",id:"term-".concat(e.id),value:e.id,onChange:i,checked:t.includes(String(e.id))}),e.name,Object(g.createElement)("span",{className:"wc-products-list-card__taxonomy-count"},e.count)))}))}}]),t}(W);r.d(t,"ProductPreview",function(){return ve});var Y=wp.i18n.__,Z=wp.element,$=Z.Component,ee=Z.RawHTML,te=wp.blocks.registerBlockType,re=wp.editor,se=re.InspectorControls,ie=re.BlockControls,ne=wp.components,ae=ne.Toolbar,ce=ne.Button,oe=ne.Dashicon,le=ne.RangeControl,ue=ne.Tooltip,de=ne.SelectControl,pe=wp.apiFetch,he={specific:{title:Y("Individual products"),description:Y("Hand-pick which products to display"),value:"specific"},category:{title:Y("Product category"),description:Y("Display products from a specific category or multiple categories"),value:"category"},filter:{title:Y("Filter products"),description:Y("E.g. featured products, or products with a specific attribute like size or color"),value:"filter",group_container:"filter"},featured:{title:Y("Featured products"),description:"",value:"featured"},on_sale:{title:Y("On sale"),description:"",value:"on_sale"},best_selling:{title:Y("Best sellers"),description:"",value:"best_selling",no_orderby:!0},top_rated:{title:Y("Top rated"),description:"",value:"top_rated",no_orderby:!0},attribute:{title:Y("Attribute"),description:"",value:"attribute"},all:{title:Y("All products"),description:Y("Display all products ordered chronologically, alphabetically, by price, by rating or by sales"),value:"all"}};function me(e){return!(he.hasOwnProperty(e)&&he[e].hasOwnProperty("no_orderby")&&he[e].no_orderby)}var be=function(e){function t(){return u()(this,t),m()(this,f()(t).apply(this,arguments))}return v()(t,e),p()(t,[{key:"render",value:function(){var e=this,t="arrow-right-alt2";"filter"===this.props.value&&this.props.extended&&(t="arrow-down-alt2");var r="wc-products-display-options__option wc-products-display-options__option--"+this.props.value;return this.props.current===this.props.value&&(t="yes",r+=" wc-products-display-options__option--current"),Object(g.createElement)("div",{className:r,onClick:function(){e.props.current!==e.props.value&&e.props.update_display_callback(e.props.value)}},Object(g.createElement)("div",{className:"wc-products-display-options__option-content"},Object(g.createElement)("span",{className:"wc-products-display-options__option-title"},this.props.title),Object(g.createElement)("p",{className:"wc-products-display-options__option-description"},this.props.description)),Object(g.createElement)("div",{className:"wc-products-display-options__icon"},Object(g.createElement)(oe,{icon:t})))}}]),t}($),fe=function(e){function t(e){var r;return u()(this,t),(r=m()(this,f()(t).call(this,e))).setWrapperRef=r.setWrapperRef.bind(o()(o()(r))),r.handleClickOutside=r.handleClickOutside.bind(o()(o()(r))),r}return v()(t,e),p()(t,[{key:"componentDidMount",value:function(){this.props.existing&&document.addEventListener("mousedown",this.handleClickOutside)}},{key:"componentWillUnmount",value:function(){this.props.existing&&document.removeEventListener("mousedown",this.handleClickOutside)}},{key:"setWrapperRef",value:function(e){this.wrapperRef=e}},{key:"handleClickOutside",value:function(e){this.wrapperRef&&!this.wrapperRef.contains(e.target)&&"wc-products-settings-heading__change-button button-link"!==e.target.getAttribute("class")&&this.props.closeMenu()}},{key:"render",value:function(){var e="wc-products-display-options";this.props.extended&&(e+=" wc-products-display-options--extended"),this.props.existing&&(e+=" wc-products-display-options--popover");var t=[];for(var r in he)t.push(Object(g.createElement)(be,a()({},he[r],{update_display_callback:this.props.update_display_callback,extended:this.props.extended,current:this.props.current,key:r})));var s=Object(g.createElement)("span",{className:"wc-products-display-options--popover__arrow"}),i=Object(g.createElement)("p",{className:"wc-products-block-description"},Y("Choose which products you'd like to display:"));return Object(g.createElement)("div",{className:e,ref:this.setWrapperRef},this.props.existing&&s,!this.props.existing&&i,t)}}]),t}($),ye=function(e){function t(e){var r;return u()(this,t),(r=m()(this,f()(t).call(this,e))).state={display:e.selected_display,menu_visible:!e.selected_display,expanded_group:""},r.updateDisplay=r.updateDisplay.bind(o()(o()(r))),r.closeMenu=r.closeMenu.bind(o()(o()(r))),r}return v()(t,e),p()(t,[{key:"updateDisplay",value:function(e){var t={display:e,menu_visible:!1,expanded_group:""},r="undefined"!==he[e].group_container&&he[e].group_container;r&&(t={menu_visible:!0,expanded_group:e},this.state.expanded_group===he[e].group_container&&(t.expanded_group="")),this.setState(t),r||this.props.update_display_callback(e)}},{key:"closeMenu",value:function(){this.setState({menu_visible:!1})}},{key:"render",value:function(){var e=this,t=null;"specific"===this.state.display?t=Object(g.createElement)(E,this.props):"category"===this.state.display?t=Object(g.createElement)(L,this.props):"attribute"===this.state.display&&(t=Object(g.createElement)(z,this.props));var r=this.state.menu_visible?Object(g.createElement)(fe,{extended:!!this.state.expanded_group,existing:!!this.state.display,current:this.state.display,closeMenu:this.closeMenu,update_display_callback:this.updateDisplay}):null,s=null;if(this.state.display){var i=["featured","on_sale","attribute","best_selling","top_rated"].includes(this.state.display)?this.state.display:"",n=Object(g.createElement)("button",{type:"button",className:"wc-products-settings-heading__change-button button-link",onClick:function(){e.setState({menu_visible:!e.state.menu_visible,expanded_group:i})}},Y("Display different products"));s=Object(g.createElement)("div",{className:"wc-products-settings-heading"},Object(g.createElement)("div",{className:"wc-products-settings-heading__current"},Y("Displaying "),Object(g.createElement)("strong",null,Y(he[this.state.display].title))),Object(g.createElement)("div",{className:"wc-products-settings-heading__change"},n))}var a=Object(g.createElement)("button",{type:"button",className:"button wc-products-settings__footer-button",onClick:this.props.done_callback},Y("Done"));if(["","specific","category","attribute"].includes(this.state.display)&&!this.props.selected_display_setting.length){var c={"":Y("Please select which products you'd like to display"),specific:Y("Please search for and select products to display"),category:Y("Please select at least one category to display"),attribute:Y("Please select an attribute")};a=Object(g.createElement)(ue,{text:c[this.state.display]},Object(g.createElement)("button",{type:"button",className:"button wc-products-settings__footer-button disabled"},Y("Done")))}return Object(g.createElement)("div",{className:"wc-products-settings "+(this.state.expanded_group?"expanded-group-"+this.state.expanded_group:"")},Object(g.createElement)("h4",{className:"wc-products-settings__title"},Object(g.createElement)(oe,{icon:"screenoptions"})," ",Y("Products")),s,r,t,Object(g.createElement)("div",{className:"wc-products-settings__footer"},a))}}]),t}($),ve=function(e){function t(){return u()(this,t),m()(this,f()(t).apply(this,arguments))}return v()(t,e),p()(t,[{key:"render",value:function(){var e=this.props.product,t=null;return e.images.length&&(t=Object(g.createElement)("img",{src:e.images[0].src,alt:""})),Object(g.createElement)("div",{className:"product-preview",key:e.id+"-preview"},t,Object(g.createElement)("div",{className:"product-title"},e.name),Object(g.createElement)("div",{className:"product-price",dangerouslySetInnerHTML:{__html:e.price_html}}),Object(g.createElement)("span",{className:"product-add-to-cart"},Y("Add to cart")))}}]),t}($),ge=function(e){function t(e){var r;return u()(this,t),(r=m()(this,f()(t).call(this,e))).state={products:[],loaded:!1,query:""},r.updatePreview=r.updatePreview.bind(o()(o()(r))),r.getQuery=r.getQuery.bind(o()(o()(r))),r}return v()(t,e),p()(t,[{key:"componentDidMount",value:function(){this.updatePreview()}},{key:"componentDidUpdate",value:function(){this.getQuery()!==this.state.query&&this.state.loaded&&this.updatePreview()}},{key:"getQuery",value:function(){var e=this.props.attributes,t=e.columns,r=e.rows,s=e.display,i=e.display_setting,n=e.orderby,a={status:"publish",per_page:r*t};"specific"===s?(a.include=i.join(","),a.per_page=i.length):"category"===s?a.category=i.join(","):"attribute"===s&&i.length?(a.attribute=J(i[0]),i.length>1&&(a.attribute_term=i.slice(1).join(","))):"featured"===s?a.featured=1:"on_sale"===s&&(a.on_sale=1),me(s)&&("price_desc"===n?(a.orderby="price",a.order="desc"):"price_asc"===n?(a.orderby="price",a.order="asc"):"title"===n?(a.orderby="title",a.order="asc"):a.orderby=n);for(var c="?",o=Object.keys(a),l=0;l<o.length;l++){var u=o[l];c+=u+"="+a[u]+"&"}return"/wc-blocks/v1/products"+c}},{key:"updatePreview",value:function(){var e=this,t=this.getQuery();e.setState({loaded:!1,query:t}),pe({path:t}).then(function(t){e.setState({products:t,loaded:!0})})}},{key:"render",value:function(){if(!this.state.loaded)return Y("Loading");if(0===this.state.products.length)return Y("No products found");var e="wc-products-block-preview cols-"+this.props.attributes.columns,t=this;return Object(g.createElement)("div",{className:e},this.state.products.map(function(e){return Object(g.createElement)(ve,{key:e.id,product:e,attributes:t.props.attributes})}))}}]),t}($),_e=function(e){function t(e){var r;return u()(this,t),(r=m()(this,f()(t).call(this,e))).state={categoriesInfo:[],categoriesQuery:"",attributeInfo:!1,attributeQuery:"",termsInfo:[],termsQuery:""},r.updateInfo=r.updateInfo.bind(o()(o()(r))),r.getQueries=r.getQueries.bind(o()(o()(r))),r}return v()(t,e),p()(t,[{key:"componentDidMount",value:function(){this.updateInfo()}},{key:"componentDidUpdate",value:function(){var e=this.getQueries();this.state.categoriesQuery===e.categories&&this.state.attributeQuery===e.attribute&&this.state.termsQuery===e.terms||this.updateInfo()}},{key:"getQueries",value:function(){var e=this.props.attributes,t=e.display,r=e.display_setting,s={attribute:"",terms:"",categories:""};if("attribute"===t&&r.length){var i=r[0].split(",")[1],n=r.slice(1).join(", ");s.attribute="/wc-blocks/v1/products/attributes/"+i,n.length&&(s.terms="/wc-blocks/v1/products/attributes/"+i+"/terms?include="+n)}else"category"===t&&r.length&&(s.categories="/wc-blocks/v1/products/categories?include="+r.join(","));return s}},{key:"updateInfo",value:function(){var e=this,t=this.getQueries();this.setState({categoriesQuery:t.categories,attributeQuery:t.attribute,termsQuery:t.terms}),t.categories.length?pe({path:t.categories}).then(function(t){e.setState({categoriesInfo:t})}):e.setState({categoriesInfo:[]}),t.attribute.length?pe({path:t.attribute}).then(function(t){e.setState({attributeInfo:t})}):e.setState({attributeInfo:!1}),t.terms.length?pe({path:t.terms}).then(function(t){e.setState({termsInfo:t})}):e.setState({termsInfo:[]})}},{key:"render",value:function(){var e=[he[this.props.attributes.display].title];if(this.state.categoriesInfo.length){var t=Y("Product categories: "),r=[],s=!0,i=!1,n=void 0;try{for(var a,c=this.state.categoriesInfo[Symbol.iterator]();!(s=(a=c.next()).done);s=!0){var o=a.value;r.push(o.name)}}catch(e){i=!0,n=e}finally{try{s||null==c.return||c.return()}finally{if(i)throw n}}e=[t+=r.join(", ")]}else if(this.state.attributeInfo&&(e=[Y("Attribute: ")+this.state.attributeInfo.name],this.state.termsInfo.length)){var l=Y("Terms: "),u=[],d=!0,p=!1,h=void 0;try{for(var m,b=this.state.termsInfo[Symbol.iterator]();!(d=(m=b.next()).done);d=!0){var f=m.value;u.push(f.name)}}catch(e){p=!0,h=e}finally{try{d||null==b.return||b.return()}finally{if(p)throw h}}l+=u.join(", "),e.push(l)}return Object(g.createElement)("div",null,e.map(function(e,t){return Object(g.createElement)("div",{className:"scope-description",key:t},e)}))}}]),t}($),we=function(e){function t(e){var r;return u()(this,t),(r=m()(this,f()(t).call(this,e))).getInspectorControls=r.getInspectorControls.bind(o()(o()(r))),r.getToolbarControls=r.getToolbarControls.bind(o()(o()(r))),r.getBlockDescription=r.getBlockDescription.bind(o()(o()(r))),r.getPreview=r.getPreview.bind(o()(o()(r))),r.getSettingsEditor=r.getSettingsEditor.bind(o()(o()(r))),r}return v()(t,e),p()(t,[{key:"getInspectorControls",value:function(){var e=this.props,t=e.attributes,r=e.setAttributes,s=t.rows,i=t.columns,n=t.display,a=t.orderby,c=Object(g.createElement)(le,{label:Y("Columns"),value:i,onChange:function(e){return r({columns:e})},min:wc_product_block_data.min_columns,max:wc_product_block_data.max_columns}),o=null;me(n)&&(o=Object(g.createElement)(de,{key:"query-panel-select",label:Y("Order Products By"),value:a,options:[{label:Y("Newness - newest first"),value:"date"},{label:Y("Price - low to high"),value:"price_asc"},{label:Y("Price - high to low"),value:"price_desc"},{label:Y("Rating - highest first"),value:"rating"},{label:Y("Sales - most first"),value:"popularity"},{label:Y("Title - alphabetical"),value:"title"}],onChange:function(e){return r({orderby:e})}}));var l=null;return"specific"!==n&&(l=Object(g.createElement)(le,{label:Y("Rows"),value:s,onChange:function(e){return r({rows:e})},min:wc_product_block_data.min_rows,max:wc_product_block_data.max_rows})),Object(g.createElement)(se,{key:"inspector"},this.getBlockDescription(),Object(g.createElement)("h3",null,Y("Layout")),c,l,o)}},{key:"getToolbarControls",value:function(){var e=this.props,t=e.attributes,r=e.setAttributes,s=t.display,i=t.display_setting,n=t.edit_mode,a=["","specific","category","attribute"].includes(s)&&!i.length,c=[{icon:"edit",title:Y("Edit"),onClick:a?function(){}:function(){return r({edit_mode:!n})},isActive:n}];return Object(g.createElement)(ie,{key:"controls"},Object(g.createElement)(ae,{controls:c}))}},{key:"getBlockDescription",value:function(){var e=this.props,t=e.attributes,r=e.setAttributes;if(!t.display.length)return null;var s=null;return t.edit_mode||(s=Object(g.createElement)("div",{className:"wc-products-scope-description--edit-quicklink"},Object(g.createElement)(ce,{isLink:!0,onClick:function(){r({edit_mode:!0})}},Y("Edit")))),Object(g.createElement)("div",{className:"wc-products-scope-descriptions"},Object(g.createElement)("div",{className:"wc-products-scope-details"},Object(g.createElement)("h3",null,Y("Current Source")),Object(g.createElement)(_e,{attributes:t})),s)}},{key:"getPreview",value:function(){return Object(g.createElement)(ge,{key:"preview",attributes:this.props.attributes})}},{key:"getSettingsEditor",value:function(){var e=this.props,t=e.attributes,r=e.setAttributes,s=t.display,i=t.display_setting;return Object(g.createElement)(ye,{key:"settings-editor",attributes:t,selected_display:s,selected_display_setting:i,update_display_callback:function(e){s!==e&&r({display:e,display_setting:[],edit_mode:["specific","attribute","category"].includes(e)})},update_display_setting_callback:function(e){return r({display_setting:e})},done_callback:function(){return r({edit_mode:!1})}})}},{key:"render",value:function(){var e=this.props.attributes.edit_mode;return[this.getInspectorControls(),this.getToolbarControls(),e?this.getSettingsEditor():this.getPreview()]}}]),t}($);te("woocommerce/products",{title:Y("Products"),icon:"screenoptions",category:"woocommerce",description:Y("Display a grid of products from a variety of sources."),supports:{inserter:!1},attributes:{columns:{type:"number",default:wc_product_block_data.default_columns},rows:{type:"number",default:wc_product_block_data.default_rows},display:{type:"string",default:""},display_setting:{type:"array",default:[]},orderby:{type:"string",default:"date"},edit_mode:{type:"boolean",default:!0}},edit:function(e){return Object(g.createElement)(we,e)},save:function(e){var t=e.attributes,r=t.rows,s=t.columns,n=t.display,a=t.display_setting,c=t.orderby,o=new Map;if("specific"!==n&&o.set("limit",r*s),o.set("columns",s),"specific"===n)o.set("ids",a.join(","));else if("category"===n)o.set("category",a.join(","));else if("featured"===n)o.set("visibility","featured");else if("on_sale"===n)o.set("on_sale","1");else if("best_selling"===n)o.set("best_selling","1");else if("top_rated"===n)o.set("top_rated","1");else if("attribute"===n){var l=a.length?J(a[0]):"",u=a.length>1?a.slice(1).join(","):"";o.set("attribute",l),u.length&&o.set("terms",u)}me(n)&&("price_desc"===c?(o.set("orderby","price"),o.set("order","DESC")):"price_asc"===c?(o.set("orderby","price"),o.set("order","ASC")):"date"===c?(o.set("orderby","date"),o.set("order","DESC")):o.set("orderby",c));var d="[products",p=!0,h=!1,m=void 0;try{for(var b,f=o[Symbol.iterator]();!(p=(b=f.next()).done);p=!0){var y=i()(b.value,2);d+=" "+y[0]+'="'+y[1]+'"'}}catch(e){h=!0,m=e}finally{try{p||null==f.return||f.return()}finally{if(h)throw m}}return d+="]",Object(g.createElement)(ee,null,d)}})}}));