jQuery(function(e){e("#upsell_product_data").bind("keypress",function(h){if(h.keyCode==13){return false}});e("ul.tabs").show();e("div.panel-wrap").each(function(){e("div.panel:not(div.panel:first)",this).hide()});e("ul.tabs a").click(function(){var h=e(this).closest("div.panel-wrap");e("ul.tabs li",h).removeClass("active");e(this).parent().addClass("active");e("div.panel",h).hide();e(e(this).attr("href")).show();return false});e("a.edit_address").click(function(){e(this).hide();e(this).closest(".order_data").find("div.address").hide();e(this).closest(".order_data").find("div.edit_address").show()});jQuery("select.chosen_select").chosen();jQuery("select.chosen_select_nostd").chosen({allow_single_deselect:"true"});e("#order_items_list button.remove_row").live("click",function(){var h=confirm(woocommerce_writepanel_params.remove_item_notice);if(h){e(this).closest("tr.item").hide();e("input",e(this).closest("tr.item")).val("")}return false});e("button.calc_totals").live("click",function(){var r=confirm(woocommerce_writepanel_params.cart_total);if(r){var j=e("#order_items_list tr.item").size();var p=0;var q=e("input#_order_discount").val();var h=e("input#_order_shipping").val();var l=parseFloat(e("input#_order_shipping_tax").val());var m=0;var k=0;var p=0;var o=0;var n=0;if(!q){q=0}if(!h){h=0}if(!l){l=0}if(j>0){for(i=0;i<j;i++){itemCost=e("input[name^=item_cost]:eq("+i+")").val();itemQty=parseInt(e("input[name^=item_quantity]:eq("+i+")").val());itemDiscount=e("input[name^=item_discount]:eq("+i+")").val();itemTax=e("input[name^=item_tax_rate]:eq("+i+")").val();if(!itemCost){itemCost=0}if(!itemTax){itemTax=0}if(!itemQty){itemQty=0}if(!itemDiscount){itemDiscount=0}totalItemTax=0;n=n+parseFloat(itemDiscount);if(itemTax&&itemTax>0){if(woocommerce_writepanel_params.prices_include_tax=="yes"){taxRate=(itemTax/100)+1;price_in_tax=(itemCost*taxRate);discounted_price=(price_in_tax*itemQty)-itemDiscount;totalItemTax=(discounted_price-(discounted_price/taxRate));if(woocommerce_writepanel_params.round_at_subtotal=="no"){totalItemTax=totalItemTax*100;totalItemTax=totalItemTax.toFixed(2);totalItemTax=Math.round(totalItemTax)/100}discounted_price=discounted_price-totalItemTax;p=p+parseFloat((itemCost*itemQty))}else{taxRate=(itemTax/100);discounted_price=(itemCost*itemQty)-itemDiscount;totalItemTax=(discounted_price*taxRate);if(woocommerce_writepanel_params.round_at_subtotal=="no"){totalItemTax=totalItemTax*100;totalItemTax=totalItemTax.toFixed(2);totalItemTax=Math.round(totalItemTax)/100}p=p+parseFloat((itemCost*itemQty))}}else{discounted_price=(itemCost*itemQty)-itemDiscount;p=p+parseFloat((itemCost*itemQty))}totalItemCost=parseFloat(discounted_price);k=k+parseFloat(totalItemCost);m=m+parseFloat(totalItemTax)}}if(woocommerce_writepanel_params.round_at_subtotal=="yes"){m=m*100;m=m.toFixed(2);m=Math.round(m)/100}o=parseFloat(k)+parseFloat(m)-parseFloat(q)+parseFloat(h)+parseFloat(l);p=p*100;p=p.toFixed(2);p=Math.round(p)/100;o=o*100;o=o.toFixed(2);o=Math.round(o)/100;if(o<0){o=0}e("input#_cart_discount").val(n.toFixed(2));e("input#_order_subtotal").val(p.toFixed(2));e("input#_order_tax").val(m.toFixed(2));e("input#_order_shipping_tax").val(l.toFixed(2));e("input#_order_total").val(o.toFixed(2))}return false});e("button.add_shop_order_item").click(function(){var k=e("select.add_item_id").val();if(k){e("table.woocommerce_order_items").block({message:null,overlayCSS:{background:"#fff url("+woocommerce_writepanel_params.plugin_url+"/assets/images/ajax-loader.gif) no-repeat center",opacity:0.6}});var h=e("table.woocommerce_order_items tbody tr.item").size();var j={action:"woocommerce_add_order_item",item_to_add:e("select.add_item_id").val(),index:h,security:woocommerce_writepanel_params.add_order_item_nonce};e.post(woocommerce_writepanel_params.ajax_url,j,function(l){e("table.woocommerce_order_items tbody#order_items_list").append(l);e("table.woocommerce_order_items").unblock();e("select.add_item_id").css("border-color","").val("");jQuery(".tips").tipTip({attribute:"tip",fadeIn:50,fadeOut:50})})}else{e("select.add_item_id").css("border-color","red")}});e("button.add_meta").live("click",function(){var h=e(this).closest("tr.item").attr("rel");e(this).closest("table.meta").find(".meta_items").append('<tr><td><input type="text" name="meta_name['+h+'][]" placeholder="'+woocommerce_writepanel_params.meta_name+'" /></td><td><input type="text" name="meta_value['+h+'][]" placeholder="'+woocommerce_writepanel_params.meta_value+'" /></td><td><button class="remove_meta button">&times;</button></td></tr>');return false});e("button.remove_meta").live("click",function(){var h=confirm("Remove this meta key?");if(h){e(this).closest("tr").remove()}return false});e("button.load_customer_billing").live("click",function(){var k=confirm(woocommerce_writepanel_params.load_billing);if(k){var h=e("#customer_user").val();if(!h){alert(woocommerce_writepanel_params.no_customer_selected);return false}var j={user_id:h,type_to_load:"billing",action:"woocommerce_get_customer_details",security:woocommerce_writepanel_params.get_customer_details_nonce};e(this).closest(".edit_address").block({message:null,overlayCSS:{background:"#fff url("+woocommerce_writepanel_params.plugin_url+"/assets/images/ajax-loader.gif) no-repeat center",opacity:0.6}});e.ajax({url:woocommerce_writepanel_params.ajax_url,data:j,type:"POST",success:function(l){var m=jQuery.parseJSON(l);if(m){e("input#_billing_first_name").val(m.billing_first_name);e("input#_billing_last_name").val(m.billing_last_name);e("input#_billing_company").val(m.billing_company);e("input#_billing_address_1").val(m.billing_address_1);e("input#_billing_address_2").val(m.billing_address_2);e("input#_billing_city").val(m.billing_city);e("input#_billing_postcode").val(m.billing_postcode);e("input#_billing_country").val(m.billing_country);e("input#_billing_state").val(m.billing_state);e("input#_billing_email").val(m.billing_email);e("input#_billing_phone").val(m.billing_phone)}e(".edit_address").unblock()}})}return false});e("button.load_customer_shipping").live("click",function(){var k=confirm(woocommerce_writepanel_params.load_shipping);if(k){var h=e("#customer_user").val();if(!h){alert(woocommerce_writepanel_params.no_customer_selected);return false}var j={user_id:h,type_to_load:"shipping",action:"woocommerce_get_customer_details",security:woocommerce_writepanel_params.get_customer_details_nonce};e(this).closest(".edit_address").block({message:null,overlayCSS:{background:"#fff url("+woocommerce_writepanel_params.plugin_url+"/assets/images/ajax-loader.gif) no-repeat center",opacity:0.6}});e.ajax({url:woocommerce_writepanel_params.ajax_url,data:j,type:"POST",success:function(l){var m=jQuery.parseJSON(l);if(m){e("input#_shipping_first_name").val(m.shipping_first_name);e("input#_shipping_last_name").val(m.shipping_last_name);e("input#_shipping_company").val(m.shipping_company);e("input#_shipping_address_1").val(m.shipping_address_1);e("input#_shipping_address_2").val(m.shipping_address_2);e("input#_shipping_city").val(m.shipping_city);e("input#_shipping_postcode").val(m.shipping_postcode);e("input#_shipping_country").val(m.shipping_country);e("input#_shipping_state").val(m.shipping_state)}e(".edit_address").unblock()}})}return false});e("button.billing-same-as-shipping").live("click",function(){var h=confirm(woocommerce_writepanel_params.copy_billing);if(h){e("input#_shipping_first_name").val(e("input#_billing_first_name").val());e("input#_shipping_last_name").val(e("input#_billing_last_name").val());e("input#_shipping_company").val(e("input#_billing_company").val());e("input#_shipping_address_1").val(e("input#_billing_address_1").val());e("input#_shipping_address_2").val(e("input#_billing_address_2").val());e("input#_shipping_city").val(e("input#_billing_city").val());e("input#_shipping_postcode").val(e("input#_billing_postcode").val());e("input#_shipping_country").val(e("input#_billing_country").val());e("input#_shipping_state").val(e("input#_billing_state").val())}return false});e("select#product-type").change(function(){var h=e(this).val();e(".show_if_simple, .show_if_variable, .show_if_grouped, .show_if_external").hide();if(h=="simple"){e(".show_if_simple").show();e("input#manage_stock").change()}else{if(h=="variable"){e(".show_if_variable").show();e("input#manage_stock").change();e("input#downloadable").prop("checked",false).change();e("input#virtual").removeAttr("checked").change()}else{if(h=="grouped"){e(".show_if_grouped").show();e("input#downloadable").prop("checked",false).change();e("input#virtual").removeAttr("checked").change()}else{if(h=="external"){e(".show_if_external").show();e("input#downloadable").prop("checked",false).change();e("input#virtual").removeAttr("checked").change()}}}}e("ul.tabs li:visible").eq(0).find("a").click();e("body").trigger("woocommerce-product-type-change",h,e(this))}).change();e("input#downloadable").change(function(){e(".show_if_downloadable").hide();if(e("input#downloadable").is(":checked")){e(".show_if_downloadable").show()}if(e(".downloads_tab").is(".active")){e("ul.tabs li:visible").eq(0).find("a").click()}}).change();e("input#virtual").change(function(){e(".show_if_virtual").hide();if(e("input#virtual").is(":checked")){e(".show_if_virtual").show()}}).change();e("input#manage_stock").change(function(){if(e(this).is(":checked")){e("div.stock_fields").show()}else{e("div.stock_fields").hide()}}).change();var f=e("#sale_price_dates_from, #sale_price_dates_to").datepicker({defaultDate:"",dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:true,showOn:"button",buttonImage:woocommerce_writepanel_params.calendar_image,buttonImageOnly:true,onSelect:function(k){var l=this.id=="sale_price_dates_from"?"minDate":"maxDate",h=e(this).data("datepicker"),j=e.datepicker.parseDate(h.settings.dateFormat||e.datepicker._defaults.dateFormat,k,h.settings);f.not(this).datepicker("option",l,j)}});e(".date-picker").datepicker({dateFormat:"yy-mm-dd",numberOfMonths:1,showButtonPanel:true,showOn:"button",buttonImage:woocommerce_writepanel_params.calendar_image,buttonImageOnly:true});e("#attributes_list select.multiselect").chosen();var d=e("#attributes_list").children("tr").get();d.sort(function(j,h){var l=e(j).attr("rel");var k=e(h).attr("rel");return(l<k)?-1:(l>k)?1:0});e(d).each(function(h,j){e("#attributes_list").append(j)});function b(){e("table.woocommerce_attributes, table.woocommerce_variable_attributes").each(function(){if(e("tbody tr",this).size()==0){e(this).parent().hide()}else{e(this).parent().show()}})}b();function c(){e("#attributes_list tr").each(function(h,j){e(".attribute_position",j).val(parseInt(e(j).index("#attributes_list tr")))})}e("button.add_attribute").click(function(){var j=e("table.woocommerce_attributes tbody tr").size();var k=e("select.attribute_taxonomy").val();if(!k){var l=e("select#product-type").val();if(l!="variable"){enable_variation='style="display:none;"'}else{enable_variation=""}e("table.woocommerce_attributes tbody").append('<tr><td class="handle"></td><td><input type="text" name="attribute_names['+j+']" /><input type="hidden" name="attribute_is_taxonomy['+j+']" value="0" /><input type="hidden" name="attribute_position['+j+']" class="attribute_position" value="'+j+'" /></td><td><input type="text" name="attribute_values['+j+']" /></td><td class="center"><input type="checkbox" checked="checked" name="attribute_visibility['+j+']" value="1" /></td><td class="center enable_variation" '+enable_variation+'><input type="checkbox" name="attribute_variation['+j+']" value="1" /></td><td class="center"><button type="button" class="remove_row button">&times;</button></td></tr>')}else{var h=e("table.woocommerce_attributes tbody tr."+k);e("table.woocommerce_attributes tbody").append(e(h));e(h).show();c()}b()});e("button.hide_row").live("click",function(){var h=confirm("Remove this attribute?");if(h){e(this).parent().parent().find("select, input[type=text]").val("");e(this).parent().parent().hide();b()}return false});e("#attributes_list button.remove_row").live("click",function(){var h=confirm("Remove this attribute?");if(h){e(this).parent().parent().remove();b();c()}return false});e("table.woocommerce_attributes tbody").sortable({items:"tr",cursor:"move",axis:"y",handle:".handle",scrollSensitivity:40,helper:function(j,h){h.children().each(function(){e(this).width(e(this).width())});h.css("left","0");return h},start:function(h,j){j.item.css("background-color","#f6f6f6")},stop:function(h,j){j.item.removeAttr("style");c()}});e(".multi_select_products button").live("click",function(){var o=e(this).parent().parent().parent().parent();var h=e(this);var k=h.parent().parent();if(k.is(".multi_select_products_target_upsell")||k.is(".multi_select_products_target_crosssell")){h.parent().remove()}else{if(h.is(".add_upsell")){var m=e(".multi_select_products_target_upsell",e(o));var n="upsell_ids[]"}else{var m=e(".multi_select_products_target_crosssell",e(o));var n="crosssell_ids[]"}var j=e("li[rel="+h.parent().attr("rel")+"]",m);if(e(j).size()>0){return false}var l=h.parent().clone();l.find("button:eq(0)").html("&times;");l.find("button:eq(1)").remove();l.find("input").val(h.parent().attr("rel"));l.find(".product_id").attr("name",n);l.appendTo(m)}});var g;e(".multi_select_products #product_search").bind("keyup click",function(){e(".multi_select_products_source").addClass("loading");e(".multi_select_products_source li:not(.product_search)").remove();if(g){g.abort()}var k=e(this).val();var h=this;var j=e(this).attr("rel");if(k.length<3){e(".multi_select_products_source").removeClass("loading");return}var l={name:j,search:encodeURI(k),action:"woocommerce_upsell_crosssell_search_products",security:woocommerce_writepanel_params.upsell_crosssell_search_products_nonce};g=e.ajax({url:woocommerce_writepanel_params.ajax_url,data:l,type:"POST",success:function(m){e(".multi_select_products_source").removeClass("loading");e(".multi_select_products_source li:not(.product_search)").remove();e(h).parent().parent().append(m)}})});var a;window.send_to_editor_default=window.send_to_editor;jQuery(".upload_file_button").live("click",function(){a=jQuery(this).parent().find(".file_path");formfield=jQuery(a).attr("name");window.send_to_editor=window.send_to_download_url;tb_show("","media-upload.php?post_id="+woocommerce_writepanel_params.post_id+"&amp;type=downloadable_product&amp;from=wc01&amp;TB_iframe=true");return false});window.send_to_download_url=function(h){file_url=jQuery(h).attr("href");if(file_url){jQuery(a).val(file_url)}tb_remove();window.send_to_editor=window.send_to_editor_default}});